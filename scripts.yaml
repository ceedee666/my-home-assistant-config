set_livingroom_temperature:
  alias: Set Livingroom Temperature
  sequence:
  - if:
    - condition: or
      conditions:
      - alias: Nobody Home
        condition: state
        entity_id: input_boolean.nobody_home_mode
        state: 'on'
      - alias: Heating Off
        condition: state
        entity_id: input_boolean.heating_off
        state: 'on'
    then:
    - data:
        temperature: 10
      target:
        entity_id: climate.livingroom_thermostat
      action: climate.set_temperature
    - data:
        hvac_mode: 'off'
      target:
        entity_id: climate.livingroom_thermostat
      action: climate.set_hvac_mode
    else:
    - if:
      - alias: Livingroom Climate Overwrite
        condition: state
        entity_id: input_boolean.livingroom_climate_overwrite
        state: 'on'
      then:
      - data:
          hvac_mode: heat
        target:
          entity_id: climate.livingroom_thermostat
        action: climate.set_hvac_mode
      - data:
          temperature: 20
        target:
          entity_id: climate.livingroom_thermostat
        action: climate.set_temperature
      else:
      - if:
        - alias: Use Schedule
          condition: state
          entity_id: schedule.schedule_livingroom
          state: 'on'
        then:
        - data:
            hvac_mode: heat
          target:
            entity_id: climate.livingroom_thermostat
          action: climate.set_hvac_mode
        - data:
            temperature: 20
          target:
            entity_id: climate.livingroom_thermostat
          action: climate.set_temperature
        else:
        - data:
            temperature: 10
          target:
            entity_id: climate.livingroom_thermostat
          action: climate.set_temperature
        - data:
            hvac_mode: 'off'
          target:
            entity_id: climate.livingroom_thermostat
          action: climate.set_hvac_mode
  mode: single
  icon: mdi:thermometer-auto
set_bathroom_temperature:
  alias: Set Bathroom Temperature
  sequence:
  - if:
    - condition: or
      conditions:
      - alias: Nobody Home
        condition: state
        entity_id: input_boolean.nobody_home_mode
        state: 'on'
      - alias: Heating Off
        condition: state
        entity_id: input_boolean.heating_off
        state: 'on'
    then:
    - data:
        temperature: 10
      target:
        entity_id: climate.bathroom_1st_floor_thermostat
      action: climate.set_temperature
    - data:
        hvac_mode: 'off'
      target:
        entity_id: climate.bathroom_1st_floor_thermostat
      action: climate.set_hvac_mode
    else:
    - if:
      - alias: Bathroom Climate Overwrite
        condition: state
        entity_id: input_boolean.bathroom_climate_overwrite
        state: 'on'
      then:
      - data:
          hvac_mode: heat
        target:
          entity_id: climate.bathroom_1st_floor_thermostat
        action: climate.set_hvac_mode
      - data:
          temperature: 22
        target:
          entity_id: climate.bathroom_1st_floor_thermostat
        action: climate.set_temperature
      else:
      - if:
        - alias: Use Schedule
          condition: state
          entity_id: schedule.schedule_bathroom_1st_floor
          state: 'on'
        then:
        - data:
            hvac_mode: heat
          target:
            entity_id: climate.bathroom_1st_floor_thermostat
          action: climate.set_hvac_mode
        - data:
            temperature: 22
          target:
            entity_id: climate.bathroom_1st_floor_thermostat
          action: climate.set_temperature
        else:
        - data:
            temperature: 10
          target:
            entity_id: climate.bathroom_1st_floor_thermostat
          action: climate.set_temperature
        - data:
            hvac_mode: 'off'
          target:
            entity_id: climate.bathroom_1st_floor_thermostat
          action: climate.set_hvac_mode
  mode: single
  icon: mdi:thermometer-auto
shutter_ground_floor:
  alias: Shutters Ground Floor
  sequence:
  - if:
    - alias: Nobody Home
      condition: state
      entity_id: input_boolean.nobody_home_mode
      state: 'on'
    then:
    - data: {}
      target:
        entity_id:
        - cover.shutters_ground_floor
      action: cover.close_cover
    else:
    - if:
      - alias: Automation Not Disabled
        condition: state
        entity_id: input_boolean.disable_shutter_automation
        state: 'off'
      then:
      - if:
        - condition: state
          entity_id: sun.sun
          attribute: rising
          state: false
        then:
        - data: {}
          target:
            entity_id:
            - cover.shutters_ground_floor
          action: cover.close_cover
        else:
        - data: {}
          target:
            entity_id:
            - cover.shutters_living_room
          action: cover.open_cover
        - if:
          - condition: and
            conditions:
            - condition: time
              after: input_datetime.shutters_blinds_summer_setting
            - condition: numeric_state
              entity_id: sensor.max_forecast_temperature_in_next_day
              above: input_number.forecast_temerature_for_hot_day
          then:
          - data: {}
            target:
              entity_id: scene.blinds_ground_floor_hot_day
            action: scene.turn_on
          else:
          - data: {}
            target:
              entity_id:
              - cover.shutter_kittchen
            action: cover.open_cover
  mode: single
  icon: mdi:window-shutter-auto
offices_power_save:
  alias: Offices Power Save
  sequence:
  - if:
    - alias: Nobody Home
      condition: state
      entity_id: input_boolean.nobody_home_mode
      state: 'on'
    then:
    - type: turn_off
      device_id: dd2d583e4120448ce7809ccd2c7ec121
      entity_id: e3081975aec220e80f140f198173a1fc
      domain: switch
    else:
    - if:
      - alias: Office Automation Overwrite
        condition: state
        entity_id: input_boolean.office_overwrite
        state: 'on'
      then:
      - type: turn_on
        device_id: dd2d583e4120448ce7809ccd2c7ec121
        entity_id: e3081975aec220e80f140f198173a1fc
        domain: switch
      else:
      - if:
        - alias: Parents Away
          condition: state
          entity_id: group.parents
          state: not_home
        then:
        - type: turn_off
          device_id: dd2d583e4120448ce7809ccd2c7ec121
          entity_id: e3081975aec220e80f140f198173a1fc
          domain: switch
        else:
        - if:
          - alias: Use Office Schedule
            condition: state
            entity_id: schedule.schedule_office_christian
            state: 'off'
          then:
          - type: turn_off
            device_id: dd2d583e4120448ce7809ccd2c7ec121
            entity_id: e3081975aec220e80f140f198173a1fc
            domain: switch
          else:
          - type: turn_on
            device_id: dd2d583e4120448ce7809ccd2c7ec121
            entity_id: e3081975aec220e80f140f198173a1fc
            domain: switch
  mode: single
  icon: mdi:desk
shutters_1st_floor:
  alias: Shutters 1st Floor Kids
  sequence:
  - if:
    - alias: Automation Not Disabled
      condition: state
      entity_id: input_boolean.disable_shutter_automation
      state: 'off'
    then:
    - if:
      - condition: state
        entity_id: sun.sun
        attribute: rising
        state: false
      then:
      - service: cover.close_cover
        data: {}
        target:
          entity_id:
          - cover.shutters_1st_floor_kids
      else:
      - if:
        - condition: or
          conditions:
          - condition: and
            conditions:
            - condition: state
              entity_id: binary_sensor.workday_sensor
              state: 'on'
            - condition: state
              entity_id: input_boolean.shutter_weekend_mode
              state: 'off'
            - condition: or
              conditions:
              - condition: time
                after: input_datetime.open_blinds_weekdays
              - condition: time
                after: input_datetime.blinds_morning_mode
          - condition: time
            after: input_datetime.open_blinds_weekend
        then:
        - if:
          - condition: and
            conditions:
            - condition: time
              after: input_datetime.blinds_morning_mode
            - condition: time
              before: input_datetime.open_blinds_weekdays
          then:
          - service: scene.turn_on
            metadata: {}
            target:
              entity_id: scene.shutters_1st_floor_morning
          else:
          - if:
            - condition: and
              conditions:
              - condition: time
                after: input_datetime.shutters_blinds_summer_setting
              - condition: numeric_state
                entity_id: sensor.max_forecast_temperature_in_next_day
                above: input_number.forecast_temerature_for_hot_day
            then:
            - service: scene.turn_on
              data: {}
              target:
                entity_id: scene.blinds_1st_floor_hot_day
            else:
            - service: cover.open_cover
              data: {}
              target:
                entity_id:
                - cover.shutters_1st_floor_kids
  mode: single
  icon: mdi:window-shutter-auto
shutters_2nd_floor:
  alias: Blinds 2nd Floor
  sequence:
  - if:
    - alias: Automation Not Disabled
      condition: state
      entity_id: input_boolean.disable_shutter_automation
      state: 'off'
    then:
    - if:
      - condition: state
        entity_id: sun.sun
        attribute: rising
        state: false
      then:
      - data: {}
        target:
          entity_id:
          - cover.blinds_2nd_floor
        action: cover.close_cover
      else:
      - if:
        - condition: or
          conditions:
          - condition: and
            conditions:
            - condition: state
              entity_id: binary_sensor.workday_sensor
              state: 'on'
            - condition: state
              entity_id: input_boolean.shutter_weekend_mode
              state: 'off'
            - condition: or
              conditions:
              - condition: time
                after: input_datetime.open_blinds_weekdays
              - condition: time
                after: input_datetime.blinds_morning_mode
          - condition: time
            after: input_datetime.open_blinds_weekend
        then:
        - if:
          - condition: and
            conditions:
            - condition: time
              after: input_datetime.blinds_morning_mode
            - condition: time
              before: input_datetime.open_blinds_weekdays
          then:
          - metadata: {}
            target:
              entity_id: scene.blinds_second_floor_morning
            action: scene.turn_on
            data: {}
          else:
          - if:
            - condition: and
              conditions:
              - condition: time
                after: input_datetime.shutters_blinds_summer_setting
              - condition: numeric_state
                entity_id: sensor.max_forecast_temperature_in_next_day
                above: input_number.forecast_temerature_for_hot_day
            then:
            - action: script.blinds_2nd_floor_hot_day
              metadata: {}
              data: {}
            else:
            - data: {}
              target:
                entity_id:
                - cover.blinds_2nd_floor
              action: cover.open_cover
  mode: single
  icon: mdi:window-shutter-auto
christmas_tree:
  alias: Christmas Tree
  sequence:
  - if:
    - condition: state
      entity_id: schedule.schedule_christmas_tree
      state: 'on'
    then:
    - type: turn_on
      device_id: 84732e8f18c85a1081837adcde98f507
      entity_id: f8da323a095057ee03a4146644868434
      domain: light
    else:
    - type: turn_off
      device_id: 84732e8f18c85a1081837adcde98f507
      entity_id: f8da323a095057ee03a4146644868434
      domain: light
  mode: single
  icon: mdi:string-lights
shutters_1st_floor_2:
  alias: Shutters 1st Floor
  sequence:
  - if:
    - condition: state
      entity_id: sun.sun
      attribute: rising
      state: false
    then:
    - service: cover.close_cover
      data: {}
      target:
        entity_id:
        - cover.shutter_bathroom_1st_floor
        - cover.shutter_office_halszka
    else:
    - if:
      - condition: and
        conditions:
        - condition: time
          after: input_datetime.shutters_blinds_summer_setting
        - condition: numeric_state
          entity_id: sensor.max_forecast_temperature_in_next_day
          above: input_number.forecast_temerature_for_hot_day
      then:
      - service: scene.turn_on
        data: {}
        target:
          entity_id: scene.blinds_1st_floor_hot_day
      else:
      - service: cover.open_cover
        data: {}
        target:
          entity_id:
          - cover.shutter_bathroom_1st_floor
          - cover.shutter_office_halszka
  mode: single
  icon: mdi:window-shutter-auto
blinds_2nd_floor_hot_day:
  sequence:
  - action: cover.set_cover_position
    metadata: {}
    data:
      position: 30
    target:
      entity_id:
      - cover.blinds_bathroom_2nd_floor
      - cover.shutter_office_christian
  - delay:
      hours: 0
      minutes: 0
      seconds: 25
      milliseconds: 0
  - action: cover.set_cover_tilt_position
    metadata: {}
    data:
      tilt_position: 30
    target:
      entity_id:
      - cover.blinds_bathroom_2nd_floor
      - cover.shutter_office_christian
  alias: Blinds 2nd Floor Hot Day
  description: ''
bmw_charging_automation:
  sequence:
  - if:
    - condition: and
      conditions:
      - condition: state
        entity_id: input_boolean.disable_charging_automation
        state: 'off'
      - condition: state
        entity_id: binary_sensor.tesla_wall_connector_vehicle_connected
        state: 'on'
    then:
    - if:
      - condition: and
        conditions:
        - condition: numeric_state
          entity_id: sensor.battery_state_of_charge
          below: 50
        - condition: state
          entity_id: input_boolean.set_discharge_limit_to_low
          state: 'off'
        - condition: state
          entity_id: switch.i5_edrive40_aufladung
          state: 'on'
      then:
      - type: turn_off
        device_id: 97674a0edff19cc2acbcc5fa588a3ec0
        entity_id: 856d64b358149682603289e81701510b
        domain: switch
      - data:
          title: i5 Charging Stopped
          message: "i5 Charging Stopped - \U0001F50B {{states('sensor.i5_edrive40_verbleibende_batterie_in_prozent')}}%"
        action: notify.mobile_app_christians_iphone_13
      else:
      - if:
        - condition: and
          conditions:
          - condition: numeric_state
            entity_id: sensor.battery_state_of_charge
            below: 25
          - condition: state
            entity_id: input_boolean.set_discharge_limit_to_low
            state: 'on'
          - condition: state
            entity_id: switch.i5_edrive40_aufladung
            state: 'on'
        then:
        - type: turn_off
          device_id: 97674a0edff19cc2acbcc5fa588a3ec0
          entity_id: 856d64b358149682603289e81701510b
          domain: switch
        - data:
            title: i5 Charging Stopped
            message: "i5 Charging Stopped - \U0001F50B {{states('sensor.i5_edrive40_verbleibende_batterie_in_prozent')}}%"
          action: notify.mobile_app_christians_iphone_13
        else:
        - if:
          - condition: and
            conditions:
            - condition: state
              entity_id: switch.i5_edrive40_aufladung
              state: 'off'
            - condition: numeric_state
              entity_id: sensor.battery_state_of_charge
              above: 90
            - condition: numeric_state
              entity_id: sensor.i5_edrive40_verbleibende_batterie_in_prozent
              below: sensor.i5_edrive40_ladeziel
          then:
          - type: turn_on
            device_id: 97674a0edff19cc2acbcc5fa588a3ec0
            entity_id: 856d64b358149682603289e81701510b
            domain: switch
          - data:
              title: i5 Charging Started
              message: "i5 Charging Started - \U0001F50B {{states('sensor.i5_edrive40_verbleibende_batterie_in_prozent')}}%"
            action: notify.mobile_app_christians_iphone_13
  alias: BMW Charging Automation
  mode: single
  icon: mdi:ev-station
  description: ''
